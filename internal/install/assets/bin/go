#!/usr/bin/env bash

GODOC=${GOSHIM_GODOC:-$(which go-doc)}
function go-doc {
  exec $GODOC "$@"
}

SHIM=$(realpath "$0")
function go {
  if ! [[ -z "$GOSHIM_GO" ]]; then
    exec $GOSHIM_GO "$@"
    return
  fi

  # Find the path to the actual `go` binary. We accept the first one we find
  # that isn't THIS script.
  local GO
  for GO in $(which -a go); do
    if [[ "$(realpath $GO)" != "$SHIM" ]]; then
      exec $GO "$@"
      return
    fi
  done
  echo "go shim: no other go executable in PATH" >&2
  exit 213
}

case $1 in
  doc)
    shift
    go-doc "$@"
    exit
    ;;
  - | --)
    # If we're being invoked as `go -` or `go --`, then we need to pass the
    # arguments through to the real `go` binary.
    shift
    ;;
  *) ;;
esac

go "$@"

# vim: shiftwidth=2
